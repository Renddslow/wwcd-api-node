module.exports = (service) => ({
  getAll: async () => {
    const prizes = await service.db.collection('prizes')
      .get();

    return Promise.all(prizes.docs.map(async (d) => {
      const prize = Object.assign({}, d.data(), {
        id: d.id,
      });

      const tickets = await service.db.collection('tickets')
        .where('prize', '==', service.db.doc(`prizes/${prize.id}`))
        .get();
      prize.committedTickets = tickets.docs.length;
      return prize;
    }));
  },
});